<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–°–ª—É—á–∞–π–Ω–∞—è –ø–µ—Å–Ω—è</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 2rem; }
    button { font-size: 1.2rem; padding: 0.5rem 1rem; margin: 1rem; }
    #player { margin-top: 1rem; }
  </style>
</head>
<body>
  <h1>üéß –°–ª—É—á–∞–π–Ω–∞—è –ø–µ—Å–Ω—è</h1>
  <button id="playBtn">–°—ã–≥—Ä–∞—Ç—å —Å–ª—É—á–∞–π–Ω—É—é –ø–µ—Å–Ω—é</button>
  <div id="player"></div>
  <div id="status"></div>

  <script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/–í–ê–®_WEB_APP_URL/exec'; // ‚Üê –∑–∞–º–µ–Ω–∏—Ç–µ!
    let songs = [];

    async function loadSongs() {
      try {
        document.getElementById('status').textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞...';
        const res = await fetch(SCRIPT_URL);
        songs = await res.json();
        document.getElementById('status').textContent = `–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${songs.length} –ø–µ—Å–µ–Ω.`;
      } catch (err) {
        document.getElementById('status').textContent = '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + err.message;
        console.error(err);
      }
    }

    function playRandomSong() {
      if (songs.length === 0) {
        alert('–°–ø–∏—Å–æ–∫ –ø–µ—Å–µ–Ω –ø—É—Å—Ç. –ü–æ–¥–æ–∂–¥–∏—Ç–µ –∑–∞–≥—Ä—É–∑–∫–∏.');
        return;
      }

      const randomSong = songs[Math.floor(Math.random() * songs.length)];
      const url = `https://drive.google.com/uc?export=download&id=${randomSong.id}`;

      const audio = new Audio(url);
      audio.controls = true;
      audio.style.width = '80%';
      audio.onerror = () => {
        alert(`–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å "${randomSong.name}". –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª –¥–æ—Å—Ç—É–ø–µ–Ω –∏ –Ω–µ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π.`);
      };

      const playerDiv = document.getElementById('player');
      playerDiv.innerHTML = '';
      playerDiv.appendChild(audio);
      
      document.getElementById('status').textContent = `–ò–≥—Ä–∞–µ—Ç: ${randomSong.name}`;
      audio.play().catch(e => {
        console.warn('Autoplay blocked:', e);
        document.getElementById('status').textContent += ' (–Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –∞—É–¥–∏–æ–ø–ª–µ–µ—Ä –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è)';
      });
    }

    document.getElementById('playBtn').addEventListener('click', playRandomSong);
    loadSongs();
  </script>
</body>
</html>
