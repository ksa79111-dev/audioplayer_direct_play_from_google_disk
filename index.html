<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üéß –°–ª—É—á–∞–π–Ω–∞—è –ø–µ—Å–Ω—è</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      max-width: 700px;
      margin: 2rem auto;
      padding: 0 1rem;
      text-align: center;
      background: #fafafa;
      color: #333;
    }
    h1 {
      font-weight: 600;
      margin-bottom: 1.5rem;
    }
    button {
      background: #4285f4;
      color: white;
      border: none;
      padding: 0.8rem 1.8rem;
      font-size: 1.1rem;
      border-radius: 6px;
      cursor: pointer;
      margin: 1rem 0;
      transition: background 0.2s;
    }
    button:hover { background: #3367d6; }
    button:disabled { background: #ccc; cursor: not-allowed; }
    #status { margin-top: 1.5rem; font-size: 1.1rem; }
    .controls {
      margin-top: 1rem;
    }
    .controls label {
      margin: 0 0.5rem;
    }
  </style>
</head>
<body>
  <h1>üéß –°–ª—É—á–∞–π–Ω–∞—è –ø–µ—Å–Ω—è</h1>
  <button id="playBtn">–°—ã–≥—Ä–∞—Ç—å —Å–ª—É—á–∞–π–Ω—É—é –ø–µ—Å–Ω—é</button>
  <div class="controls">
    <label>
      <input type="checkbox" id="shuffle" checked> –°–ª—É—á–∞–π–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫
    </label>
    <label>
      <input type="checkbox" id="loop" checked> –ü–æ–≤—Ç–æ—Ä—è—Ç—å
    </label>
  </div>
  <div id="status">–ì–æ—Ç–æ–≤–æ</div>
  <audio id="player" style="display:none"></audio>

  <script>
    const songs = [
      { id: "1aVQDA7YIZ_9-x8XKc68wrDbgR-8SHTLI", name: "mix.mp3" },
      { id: "1Gsk4HO7GXi0o18z5bESw2Iqe8cJc4hmg", name: "Dan Balan - Lendo Calendo" },
      { id: "1JA84mlS_3I8PGwOXeZa3l8XqYiIGdmpn", name: "DVBBS - Tsunami" },
      { id: "1-4cojYT8WyLgfRqcFON2LKqybWSCh4OL", name: "The Hardkiss - Make Up" }
    ];

    let currentIndex = -1;
    let isPlaying = false;
    const player = document.getElementById('player');
    const playBtn = document.getElementById('playBtn');
    const statusEl = document.getElementById('status');
    const shuffleCheck = document.getElementById('shuffle');
    const loopCheck = document.getElementById('loop');

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ —Ç—Ä–µ–∫–∞
    player.onended = () => {
      if (loopCheck.checked) {
        playNextSong();
      } else {
        stopPlayback();
      }
    };

    player.onerror = () => {
      statusEl.textContent = `‚ùå –û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è: ${player.error?.message || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}`;
      stopPlayback();
    };

    function getRandomIndex() {
      return Math.floor(Math.random() * songs.length);
    }

    function getNextIndex() {
      if (shuffleCheck.checked) {
        let next;
        do {
          next = getRandomIndex();
        } while (songs.length > 1 && next === currentIndex);
        return next;
      } else {
        return (currentIndex + 1) % songs.length;
      }
    }

    function playSong(index) {
      if (index < 0 || index >= songs.length) return;
      
      currentIndex = index;
      const song = songs[index];
      
      // ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ–∫—Å–∏ —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
      const directUrl = `https://drive.google.com/uc?export=download&id=${song.id}&confirm=t`;
      const proxyUrl = 'https://api.codetabs.com/v1/proxy?quest=' + encodeURIComponent(directUrl);
      
      player.src = proxyUrl;
      statusEl.textContent = `‚ñ∂Ô∏è –ó–∞–≥—Ä—É–∑–∫–∞: ${song.name}‚Ä¶`;
      
      // play() –ø–æ—Å–ª–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è src ‚Äî —Ä–∞–∑—Ä–µ—à–µ–Ω–æ –≤ —Ä–∞–º–∫–∞—Ö —Å–µ—Å—Å–∏–∏
      player.play()
        .then(() => {
          statusEl.textContent = `‚ñ∂Ô∏è –ò–≥—Ä–∞–µ—Ç: ${song.name}`;
          playBtn.textContent = '–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å';
          isPlaying = true;
        })
        .catch(err => {
          statusEl.textContent = `‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–∏–≥—Ä–∞—Ç—å: ${song.name} (${err.name})`;
          console.error(err);
        });
    }

    function playNextSong() {
      const nextIndex = getNextIndex();
      playSong(nextIndex);
    }

    function startPlayback() {
      if (isPlaying) {
        // –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
        stopPlayback();
      } else {
        // –ù–∞—á–∞—Ç—å: —Å–ª—É—á–∞–π–Ω—ã–π —Ç—Ä–µ–∫
        const index = shuffleCheck.checked ? getRandomIndex() : 0;
        playSong(index);
      }
    }

    function stopPlayback() {
      player.pause();
      player.src = '';
      isPlaying = false;
      playBtn.textContent = '–°—ã–≥—Ä–∞—Ç—å —Å–ª—É—á–∞–π–Ω—É—é –ø–µ—Å–Ω—é';
      statusEl.textContent = '–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ';
    }

    playBtn.addEventListener('click', startPlayback);
  </script>
</body>
</html>
